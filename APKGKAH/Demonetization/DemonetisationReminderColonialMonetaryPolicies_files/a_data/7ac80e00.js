function class_Constants(){this.PLUGIN_MESSAGING={english:{back:"BACK",byAuthor:function(a){return"By "+a},cart:"Your cart",chooseAmount:"Choose amount",cancel:"CANCEL",close:"CLOSE",continueWithoutSaving:"CONTINUE WITHOUT SAVING",dateStr:"DATE",forThisArticle:"FOR THIS ARTICLE",learnMore:["This is your shopping cart","Add to your cart for articles you like","Pay when you're ready. There are no deadlines"],minutes:"Minutes",partnerLink:function(a){return'An <a href="https://orcsnet.com/" target="_blank" rel="nofollow" style="color:'+a+';">Orcsnet</a> Partner Website'},pay:"PAY",payLater:"PAY LATER",payNow:"PAY NOW",pending:"PENDING",pgCosts:"PG COSTS",pgFeesExtra:"*PG Fees addl.",rupeeSymbol:"₹",save:"SAVE",saveForLater:"SAVE FOR LATER",subtotal:"SUBTOTAL",thankYou:"Thank you for your support",totalStr:"TOTAL",visits:"Visits",yourActivity:"Your activity",yourCart:"Your cart",yourInvoice:"Your invoice",monthly:"MONTHLY",annual:"ANNUAL",oneTime:"ONE-TIME",autodebit:"AUTO-DEBIT"},hindi:{cart:"रकम का पिटारा",pending:"रकम का पिटारा",chooseAmount:"रकम चुनें",yourInvoice:"आपकी रसीद",yourCart:"रकम का पिटारा",partnerLink:function(a){return'<a href="https://orcsnet.com/" target="_blank" rel="nofollow" style="color:'+a+';">ओर्क्स्नेट</a> पार्टनर साईट'},payNow:"भुगतान करें",payLater:"बाद में भुगतान करें",saveForLater:"बाद में भुगतान करें",close:"खाली है!",cancel:"वापस जाएँ",byAuthor:function(a){return a+" द्वारा"},dateStr:"तारीख",subtotal:"सहोयग राशि",pgCosts:"गेटवे लागत",totalStr:"कुल",pay:"भुगतान करें",forThisArticle:"इस लेख के लिए",back:"रद्द करें / वापस जाएँ",thankYou:"आपके सहयोग के लिए धन्यवाद",continueWithoutSaving:"आगे बढे",learnMore:["यह आपकी शॉपिंग कार्ट है","अपनी पसंद के लेखों के लिए अपनी कार्ट में जोड़ें","जब आप तैयार हों तब भुगतान करें","कोई समय सीमा नहीं है"],yourActivity:"आपकी गतिविधि",visits:"दौरा",minutes:"मिनट",rupeeSymbol:"₹"},tamil:{rupeeSymbol:"ரூ.",chooseAmount:"தொகையைத் தேர்வு செய்யுங்கள்",yourActivity:"உங்கள் செயல்பாடு",visits:"வருகைகள்",minutes:"நிமிடங்கள்"}}}function class_LocalStorage(){var a=function(a){return a&&JSON.parse(atob(a))||null},b=function(a){return btoa(JSON.stringify(a))},c=function(a){return a.substring("orcsnet:q:".length)},d=function(a){return"orcsnet:q:"+String(a)},e=function(a){return 0===a.indexOf("orcsnet:q:")},f=function(){};this.listeners=[],this.registerListener=function(a){this.listeners.push(a)},this.eventQ={},this._loadEventIntoQ=function(a,b){b?this.eventQ[a]=b:delete this.eventQ[a],this.listeners.forEach(function(a){a()})},this.loadFromLS=function(){if(this.localStorageAvailable)for(var b in window.localStorage)if(e(b)){var d=c(b),g=a(window.localStorage.getItem(b));g&&(g.url=decodeURIComponent(g.url),g.title=decodeURIComponent(g.title),g.author=decodeURIComponent(g.author),f("[loadFromLS]: @["+d+"]: "+g.author+" | "+g.amt)),this._loadEventIntoQ(d,g)}},this.flushQ=function(){if(this.localStorageAvailable){for(var a in window.localStorage)e(a)&&window.localStorage.removeItem(a);this.eventQ={}}},this.init=function(){if(this.localStorageAvailable){this.loadFromLS();var b=this;window.addEventListener("storage",function(d){if(e(d.key)){var g=c(d.key),h=a(d.newValue);h&&(h.url=decodeURIComponent(h.url),h.title=decodeURIComponent(h.title),h.author=decodeURIComponent(h.author),f("[storage-listener]: @["+g+"]: "+h.author+" | "+h.amt)),b._loadEventIntoQ(g,h)}})}},this.addEventToQ=function(a){var c=(new Date).valueOf();f("[addEventToQ]: @["+c+"]: "+a.author+" | "+a.amt);var e={};for(var g in a)a.hasOwnProperty(g)&&(e[g]=a[g]);a.url=encodeURIComponent(a.url),a.title=encodeURIComponent(a.title),a.author=encodeURIComponent(a.author),this.localStorageAvailable&&window.localStorage.setItem(d(c),b(a)),this._loadEventIntoQ(c,e)},this.getCurrentState=function(){var a=Object.keys(this.eventQ);a.sort(),a.reverse();var b=[],c=[];return a.forEach(function(a){for(var d=this.eventQ[a],e=!1,g=0;g<c.length;g++)if(c[g].url===d.url){e=!0;break}e||(f("[LS.getCurrentState] @["+a+"]: "+d.author+" | "+d.amt),c.push({url:d.url}),d.amt>0&&b.push(d))},this),b}}function class_Payments(a){"use strict";this.app=a,this.afterPayment=function(a){if(this.app.parsedParams.localStorageAvailable){window.localStorage.setItem("orcsnet:last_payment",(new Date).valueOf()),window.localStorage.setItem("orcsnet:last_payment_date",a.pdate),window.localStorage.setItem("orcsnet:last_payment_type",a.ptype),window.localStorage.setItem("orcsnet:last_payment_amt",a.amt_paise),window.localStorage.setItem("orcsnet:last_payment_to",this.app.parsedParams.ownerid);var b=window.localStorage.getItem("orcsnet:npayments")||0;window.localStorage.setItem("orcsnet:npayments",String(1+Number(b)))}this.app.sendEvent_v2({action:"payment-success",amount:a.amt_paise/100,payment_id:a.payment_id,ptype:a.ptype})},this.rpSubscriptionOptions=function(a){var b=this,c=this.app.configMgr.getConfigVal("submerchantAccountId"),d={key:"rzp_live_partner_BCZPsu08cVbYui",account_id:c,name:this.app.configMgr.getConfigVal("ownerName"),description:"An Orcsnet partner website",handler:function(c){b.afterPayment({pdate:(new Date).valueOf(),ptype:"subscription",amt_paise:a.notes.button_amount,payment_id:c.razorpay_payment_id}),a.onsuccess&&a.onsuccess(c.razorpay_payment_id)},modal:{ondismiss:function(){document.getElementById("orcsnet").style.height="",a.ondismiss&&a.ondismiss()}},notes:a.notes,image:this.app.configMgr.getConfigVal("rplogoUrl")||this.app.configMgr.getConfigVal("logoUrl"),theme:{color:this.app.configMgr.getConfigVal("rpColor")||this.app.configMgr.getConfigVal("bgColor")},subscription_id:a.subscription_id,prefill:{}};return d},this.rpOptions=function(a){var b=this,c={name:this.app.configMgr.getConfigVal("ownerName"),description:"An Orcsnet partner website",handler:function(c){b.afterPayment({pdate:(new Date).valueOf(),ptype:"one-time",amt_paise:a.notes.button_amount,payment_id:c.razorpay_payment_id}),a.onsuccess&&a.onsuccess(c.razorpay_payment_id)},modal:{ondismiss:function(){document.getElementById("orcsnet").style.height="",a.ondismiss&&a.ondismiss()}},notes:a.notes,image:this.app.configMgr.getConfigVal("rplogoUrl")||this.app.configMgr.getConfigVal("logoUrl"),theme:{color:this.app.configMgr.getConfigVal("rpColor")},amount:String(a.amount)},d=this.app.configMgr.getConfigVal("submerchantAccountId");d?(c.key="rzp_live_partner_BCZPsu08cVbYui",c.account_id=d):c.key="rzp_live_CfH4Q5XXguxnY4";var e=this.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:useremail")||null;e&&(c.prefill=c.prefill||{},c.prefill.email||(c.prefill.email=e));var f=this.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:userphone")||null;return f&&(c.prefill=c.prefill||{},c.prefill.contact||(c.prefill.contact=f)),c},this.addFees=function(a,b){var c=function(a){var b=.02,c=.18,d=Math.round(100*a/(1-b*(1+c)))/100,e=Math.round(100*d*b)/100,f=Math.round(100*e*c)/100,g=a-Math.round(100*(d-e-f))/100;d+=g,d=Math.round(100*d)/100;var h=Math.round(100*(d-a))/100;return{amount_to_pay:d,fees:h}},d=b||this.app.parsedParams.ownerid,e=a,f=["dhakad-khabar","IndiaSpend","the-wire","twtest","newswing"],g={};f.indexOf(d)>-1?(g.amount_to_pay=a,g.fees=0):g=c(a);var h={button_amount:e,amount_to_pay:g.amount_to_pay,fees:g.fees,base_amount:e,base_amount_gst:0};return h},this.createOrderNotes=function(a){var b=AWS.config.credentials.identityId||"unavailable";b=b.replace("ap-south-1:","").replace(/-/g,"");var c={cmpuid:b,pubname:this.app.parsedParams.ownerid,channel:this.app.parsedParams.channel,content_id:this.app.parsedParams.content_url,configname:this.app.subconfigName,button_amount:Math.round(100*a.button_amount),payment_type:a.payment_type};return a.userpan&&(c.PAN=a.userpan),a.firstName&&(c.firstName=a.firstName),a.lastName&&(c.lastName=a.lastName),c},this.payWithPayTMSpot=function(a){var b=this.createOrderNotes(a),c=b.cmpuid+String((new Date).valueOf());b.order_id=(b.pubname+"-"+md5(c)).substr(0,49),b.paid_amount=Math.round(100*a.amount_to_pay);var d,e="https://paywithpaytm.orcsnet.com",f=this;window.addEventListener("message",function(c){var g=c.origin||c.originalEvent.origin;if(g===e)if("ready"===c.data.state){var h={order:{orderid:b.order_id,custid:b.cmpuid,txn_amt:a.amount_to_pay,callback_url:"https://p1sd5k4fq6.execute-api.ap-south-1.amazonaws.com/prod/paytm",configname:f.app.subconfigName}};Plugin.log("sending order:"),Plugin.log(h),d.postMessage(h,e)}else"lambda-failure"===c.data.status?(d&&d.close(),a.callbacks&&a.callbacks.otherfail&&a.callbacks.otherfail(c.data.status)):"paytm-failure"===c.data.status?(d&&d.close(),a.callbacks&&a.callbacks.paytmfail&&a.callbacks.paytmfail(c.data.response_code)):"success"===c.data.status&&(d&&d.close(),f.afterPayment({pdate:(new Date).valueOf(),ptype:"one-time",amt_paise:a.button_amount,payment_id:c.data.payment_id}),a.callbacks&&a.callbacks.success&&a.callbacks.success(c.data.payment_id))}),new AWS.Lambda({region:"ap-south-1"}).invoke({FunctionName:"PayTMCreateOrder",Payload:JSON.stringify({order:b})},function(){}),d=open(e);var g=setInterval(function(){(!d||d.closed)&&(a.callbacks&&a.callbacks.paytmfail&&a.callbacks.paytmfail("window-closed"),clearInterval(g))},1e3)},this.payWithRazorpay_Spot=function(a){document.getElementById("orcsnet").style.height="600px";var b=this.rpOptions({amount:Math.round(100*a.amount_to_pay),ondismiss:a.callbacks.ondismiss,onsuccess:a.callbacks.onsuccess,notes:this.createOrderNotes(a)});a.usermethod&&(b.prefill=b.prefill||{},b.prefill.method=a.usermethod),a.email&&(b.prefill=b.prefill||{},b.prefill.email=a.email),a.phone&&(b.prefill=b.prefill||{},b.prefill.contact=a.phone),Plugin.log(b);var c=new Razorpay(b);c.open()},this.payWithRazorpay_SubMerchantAccountSubscription=function(a){try{document.getElementById("orcsnet").style.height="600px"}finally{}var b=this,c=new AWS.Lambda({region:"ap-south-1"});c.invoke({FunctionName:"CreateSubscription",Payload:JSON.stringify({pubname:b.app.parsedParams.ownerid,planAmount:String(a.plan_amount),planFrequency:a.subscription_type})},function(c,d){if(c)a.callbacks.onerror&&a.callbacks.onerror(c);else{var e=JSON.parse(d.Payload);if(e.error)a.callbacks.onerror&&a.callbacks.onerror(e.error);else{var f=b.rpSubscriptionOptions({subscription_id:e.subscription_id,ondismiss:a.callbacks.ondismiss,onsuccess:a.callbacks.onsuccess,notes:b.createOrderNotes({button_amount:a.plan_amount,payment_type:"subscription"})});f.notes.psId=e.plan_id+"."+e.subscription_id,f.notes.frequency=a.subscription_type,a.usermethod&&(f.prefill=f.prefill||{},f.prefill.method=a.usermethod),a.email&&(f.prefill=f.prefill||{},f.prefill.email=a.email),a.phone&&(f.prefill=f.prefill||{},f.prefill.contact=a.phone),a.userpan&&(f.notes.PAN=a.userpan),a.firstName&&(f.notes.firstName=a.firstName),a.lastName&&(f.notes.lastName=a.lastName),a.supporterName&&(f.notes.supporterName=a.supporterName),Plugin.log(f);var g=new Razorpay(f);g.open()}}})}}function class_Config(a){this.app=a,this.constants=new class_Constants,this.config=null,this.scfg=null,this.getS3Config=function(a,b){var c;c=this.app.localhost?"http://localhost:9005/plugin_config/":"https://plugin.orcsnet.com/plugin_config/",this.app.parsedParams.test_config&&(c+="test_config/"),c+="root"===a?this.app.parsedParams.ownerid+".json":this.app.parsedParams.ownerid+"."+a+".json",this.app.parsedParams.force_refresh&&!this.app.localhost&&(c+="?force="+(new Date).getTime()),console.log(c);var d=new XMLHttpRequest;d.open("GET",c,!0),d.onreadystatechange=function(){4===this.readyState&&(200===this.status?this.responseText.trim()&&b("root"===a?JSON.parse(this.responseText.trim()):JSON.parse(this.responseText.trim())):(console.log("failed to fetch "+c),b(null)))},d.send()},this.getChannelConfig=function(a){this.config=a,this.scname=this.app.parsedParams.channel;var b=this.app.parsedParams.content_url;b&&a.urlOverride&&b.toLowerCase()===a.urlOverride.url.toLowerCase()&&(this.scname=a.urlOverride.scname),this.app.subconfigName=this.scname,this.getS3Config(this.scname,this.onChannelConfig.bind(this))},this.onChannelConfig=function(a){this.scfg=a,this.app.onValidConfig()},this.getUxv2Flow=function(){return this.scfg&&this.scfg.hasOwnProperty("uxv2.flow")?this.scfg["uxv2.flow"]:this.config&&this.config.hasOwnProperty("uxv2.flow")?this.config["uxv2.flow"]:this.defaultUxv2Flow()},this.defaultUxv2Flow=function(){return{transitions:{p_cta_1:{c_next:"p_methodselection_1",cta1:"Support our work",amounts:[10,100,1e3,50,500,5e3]},p_methodselection_1:{c_back:"p_cta_1",c_next:"p_gotopg"},p_gotopg:{c_back:"p_methodselection_1"},p_invoice_1:{ui:{platestyle:"border: 1px solid black;"}}},start:"p_cta_1",endscreen:"p_invoice_1"}},this.getConfigVal=function(a){return this.scfg&&this.scfg.hasOwnProperty(a)?this.scfg[a]:this.config&&this.config.hasOwnProperty(a)?this.config[a]:this.uxv2&&this.publisherConfig.uxv2.hasOwnProperty(a)?this.publisherConfig.uxv2[a]:this.publisherConfig["default"][a]},this.getStringVal=function(a){return this.scfg&&this.scfg.strings&&this.scfg.strings.hasOwnProperty(a)?this.scfg.strings[a]:this.config&&this.config.strings&&this.config.strings.hasOwnProperty(a)?this.config.strings[a]:this.uxv2&&this.language&&this.str_uxv2.hasOwnProperty(this.language)&&this.str_uxv2[this.language].hasOwnProperty(a)?this.str_uxv2[this.language][a]:this.publisherConfig["default"][a]||""},this.str_uxv2={english:{support:"SUPPORT",tryAnother1:"Trouble with payment gateway?",tryAnother2:"Try another",thankYou:"Thank you"},hindi:{support:"हमें सहयोग दीजिये",tryAnother1:"पेमेंट गेटवे असफल?",tryAnother2:"दोबारा ट्राय करें",thankYou:"धन्यवाद"},urdu:{support:"مدد کریں",tryAnother1:"ادائیگی ناکام ہے",tryAnother2:"دوبارہ کوشش کریں",thankYou:"شکریہ"}},this.publisherConfig={"default":{borderDef:"border: 1px solid grey; border-radius: 3px;",btnBrdrWth:"3px",fontWt:"300",fontFamily:"Roboto, serif",headerBrdDef:"",headerCTAFtSz:"18",leftBrdDef:"",leftCTAFtSz:"16",cta_hr_mt:"10px",cta_left_lh:"",cta_tnc_mrt:"5px",headerHt:"200",headerImgHt:"120",outerPadding:"10px",showLogo:"header",ctaMarginTop:"40",ctaMarginBottom:"30",containerHt:"140",back:this.constants.PLUGIN_MESSAGING.english.back,byAuthor:this.constants.PLUGIN_MESSAGING.english.byAuthor,cancel:this.constants.PLUGIN_MESSAGING.english.cancel,cart:this.constants.PLUGIN_MESSAGING.english.cart,chooseAmount:this.constants.PLUGIN_MESSAGING.english.chooseAmount,close:this.constants.PLUGIN_MESSAGING.english.close,continueWithoutSaving:this.constants.PLUGIN_MESSAGING.english.continueWithoutSaving,dateStr:this.constants.PLUGIN_MESSAGING.english.dateStr,forThisArticle:this.constants.PLUGIN_MESSAGING.english.forThisArticle,learnMore:this.constants.PLUGIN_MESSAGING.english.learnMore,minutes:this.constants.PLUGIN_MESSAGING.english.minutes,partnerLink:this.constants.PLUGIN_MESSAGING.english.partnerLink,pay:this.constants.PLUGIN_MESSAGING.english.pay,payLater:this.constants.PLUGIN_MESSAGING.english.payLater,payNow:this.constants.PLUGIN_MESSAGING.english.payNow,pending:this.constants.PLUGIN_MESSAGING.english.pending,pgCosts:this.constants.PLUGIN_MESSAGING.english.pgCosts,pgFeesExtra:this.constants.PLUGIN_MESSAGING.english.pgFeesExtra,rupeeSymbol:this.constants.PLUGIN_MESSAGING.english.rupeeSymbol,save:this.constants.PLUGIN_MESSAGING.english.save,saveForLater:this.constants.PLUGIN_MESSAGING.english.saveForLater,subtotal:this.constants.PLUGIN_MESSAGING.english.subtotal,thankYou:this.constants.PLUGIN_MESSAGING.english.thankYou,totalStr:this.constants.PLUGIN_MESSAGING.english.totalStr,visits:this.constants.PLUGIN_MESSAGING.english.visits,yourActivity:this.constants.PLUGIN_MESSAGING.english.yourActivity,yourCart:this.constants.PLUGIN_MESSAGING.english.yourCart,yourInvoice:this.constants.PLUGIN_MESSAGING.english.yourInvoice,monthly:this.constants.PLUGIN_MESSAGING.english.monthly,annual:this.constants.PLUGIN_MESSAGING.english.annual,oneTime:this.constants.PLUGIN_MESSAGING.english.oneTime,autodebit:this.constants.PLUGIN_MESSAGING.english.autodebit},uxv2:{}}}function class_Plugin(){"use strict";this.positioning={},this.payments=new class_Payments(this),this.configMgr=new class_Config(this),this.init=function(a){Plugin.log("[Plugin.app.init]"),this.localhost=!1,this.localhost&&(Plugin.log=function(a){Plugin.app.parsedParams?console.log("["+Plugin.app.parsedParams.iframe_id+"]: ",a):console.log(a)},Plugin.log("[Plugin.app.init]: starting console logger")),this.parsedParams=a,this.configMgr.getS3Config("root",this.configMgr.getChannelConfig.bind(this.configMgr))},this.setupLocalTracker=function(){if(!this.parsedParams.localStorageAvailable)return void this.sendEvent_v2({action:"no-localstorage"});var a=this.parsedParams.ownerid,b=function(b){return"orcsnet:"+b+":"+a},c=function(a){return Number(localStorage.getItem(b(a)))},d=this;if("plugin"===this.parsedParams.channel)setTimeout(function(){var a=c("site-visits")+1,e=(new Date).valueOf();localStorage.setItem(b("site-visits"),String(a)),localStorage.setItem(b("last-visit"),String(e));var f=c("site-seconds")+15;localStorage.setItem(b("site-seconds"),String(f)),d.sendEvent_v2({action:"stats",site_visits:String(a),site_seconds:String(f),last_visit:String(e)});var g=5;setInterval(function(){var a=c("site-seconds")+g;localStorage.setItem(b("site-seconds"),String(a))},1e3*g)},15e3);else{var e=this.parsedParams.channel,f=c(e+"-visits")+1,g=(new Date).valueOf();localStorage.setItem(b(e+"-visits"),String(f)),localStorage.setItem(b(e+"-last-visit"),String(g)),d.sendEvent_v2({action:"c-stats",channel_visits:String(f),last_visit:String(g)})}},this.sendMsgToParent=function(a){this.parsedParams.iframe_id&&this.origin&&(a.iframe_id=this.parsedParams.iframe_id,window.parent.postMessage(a,this.origin))},this.sendHeight=function(){var a=document.getElementById("orcsnet").getClientRects();if(a.length>0){var b=a[0].height;this.nTimesWeDidntSendHt||(this.nTimesWeDidntSendHt=1,this.nTimesWeDidntSendHtLimit=20),this.nTimesWeDidntSendHt++,(b!==this.plugin_ht||this.nTimesWeDidntSendHt>this.nTimesWeDidntSendHtLimit)&&(this.sendMsgToParent({action:"height",height:b}),this.plugin_ht=b,this.nTimesWeDidntSendHt=1,this.nTimesWeDidntSendHtLimit*=2,this.nTimesWeDidntSendHtLimit>300&&(this.nTimesWeDidntSendHtLimit=300))}},this.sendScrollIntoView=function(){this.sendMsgToParent({action:"scroll-into-view"})},this.requestPositioning=function(){this.sendMsgToParent({action:"send-positioning"})},this.sendPositioning=function(){this.sendMsgToParent({action:"set-positioning",positioning:this.positioning})},this.pluginMessageHandler=function(a){var b=a.origin||a.originalEvent.origin;if(b===this.origin){var c=a.data;c&&c.positioning&&(this.positioning=c.positioning,Plugin.log("[Plugin.app.pluginMessageHandler]: rcvd positioning "+JSON.stringify(this.positioning))),c&&c.getrootconfig&&this.sendMsgToParent({rootconfig:this.configMgr.config}),c&&c.getchannelconfig&&this.sendMsgToParent({channelconfig:this.configMgr.scfg}),c&&c.getuxv2flow&&this.sendMsgToParent({uxv2flow:this.configMgr.getUxv2Flow()}),c&&c.setrootconfig&&(this.configMgr.config=c.setrootconfig,this.backToFront()),c&&c.setchannelconfig&&(this.configMgr.scfg=c.setchannelconfig,this.backToFront())}},this.thisUrlExists=function(){return-1<this.unpaid.findIndex({url:Plugin.app.parsedParams.content_url})},this.onValidConfig=function(){if(Plugin.log("[Plugin.app.onValidConfig]: ready"),"samachara"!==this.parsedParams.ownerid||this.localhost||"plugin"!==this.parsedParams.channel)if(this.parsedParams.wp_link){var a=this.parsedParams.wp_link.split("/");this.origin=a[0]+"//"+a[2]}else this.parsedParams.origin?this.origin=this.parsedParams.origin:this.origin=this.configMgr.getConfigVal("contentUrl");else this.origin="https://www.samachara.com";this.parsedParams.content_url||(this.parsedParams.content_url=this.configMgr.getConfigVal("contentUrl")),this.configMgr.language=this.parsedParams.language||this.configMgr.getConfigVal("language")||"english",this.firstTimeUser=!1,this.startTime=(new Date).valueOf(),setInterval(this.sendHeight.bind(this),100),window.addEventListener("message",this.pluginMessageHandler.bind(this)),this.storage=new class_LocalStorage,this.storage.localStorageAvailable=this.parsedParams.localStorageAvailable,this.storage.init(),this.parsedParams.channel=this.parsedParams.channel.trim(),"supportkl"===this.parsedParams.channel?this.ux="supportkl":"the-wire"===this.parsedParams.ownerid&&"support"===this.parsedParams.channel?this.ux="supportthewire":"support"===this.parsedParams.channel?this.ux="supportpage":this.ux="allinone","plugin"===this.parsedParams.channel&&"http://ippodhu.com/support-ippodhu/"===this.parsedParams.content_url&&(this.ux="allinone",this.channel="support",this.parsedParams.channel="support"),this.configMgr.getConfigVal("uxv2")&&(this.ux="uxv2"),"uxv2"===this.parsedParams.ux&&(this.ux="uxv2"),"uxv2"===this.ux&&(this.configMgr.uxv2=!0);var b=this.parsedParams.channel.indexOf(",");b>-1&&(this.parsedParams.channel=this.parsedParams.channel.substring(0,b).trim()),this.parsedParams.subscriptionManagement&&(this.ux="subscription-management");var c=this;this.storage.registerListener(function(){c.currentView&&c.currentView.updateCart&&c.currentView.updateCart()}),AWS.config.region="ap-south-1",AWS.config.correctClockSkew=!0,AWS.config.credentials&&AWS.config.credentials.clearCachedId(),AWS.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:"ap-south-1:8c5554f0-5d82-47a3-9215-4e3f1d0f334c"}),c.fbtf=!1,AWS.config.credentials.get(function(){"default"!==c.parsedParams.ownerid&&c.setupLocalTracker(),c.fbtf||c.backToFront()}),setTimeout(function(){c.fbtf||c.backToFront()},2e3)},this.backToFront=function(){switch(this.fbtf=!0,this.unpaid=new Backbone.Collection(this.storage.getCurrentState()),this.ux){case"supportkl":this.loadSupportKL();break;case"supportthewire":this.loadSupportTheWire();break;case"supportpage":this.loadSupportPage();break;case"allinone":this.loadAllInOne();break;case"uxv2":this.loadUxv2();break;case"subscription-management":this.loadSubscriptionManagement();break;default:this.loadAllInOne()}},this.packageRoyaltyForJson=function(a){var b={version:2,to:a.to,url:encodeURIComponent(a.url),amt:100*a.amt};return b},this.sendEvent=function(a){},this.sendEvent_v2=function(a){if(a=a||{},window.AWS&&AWS.config&&AWS.config.credentials&&AWS.config.credentials.identityId){var b="https://plugin.orcsnet.com"===window.location.origin,c=AWS.config.credentials.identityId.substr(11);if("7724a373-3ce4-4389-91bd-9bcdd85a2963"===c)return;var d="v2",e=String((new Date).valueOf()),f=c+"_"+String(this.startTime),g=b&&navigator.userAgent&&navigator.userAgent.replace(/,/g,"")||"",h=String((new Date).getTimezoneOffset()),i=window.Intl&&window.Intl.DateTimeFormat().resolvedOptions().timeZone||h,j=this.parsedParams.ownerid,k=this.ux,l=this.parsedParams.channel;if("default"===j)return;var m=[d,e,f,g,i,j,k,l];m.push(a.action),"tap"===a.action?(m.push(a.this_royalty),m.push(a.cart_total)):"cart-open"===a.action?(m.push(a.this_royalty),m.push(a.cart_total)):"cart-cancel-other-publisher"===a.action?(m.push(a.publisher),m.push(a.cancel_amount),m.push(a.cart_total)):"cart-close"===a.action?(m.push(a.this_royalty),m.push(a.cart_total)):"need-userinfo-for-payment"===a.action||"userinfo-open"===a.action||("userinfo-back"===a.action?m.push(a.has_userinfo):"userinfo-save"===a.action||"userinfo-skip"===a.action||("cart-pay"===a.action?(m.push(a.this_royalty),m.push(a.cart_total),m.push(a.amount)):"insta-pay"===a.action?m.push(a.amount):"insta-pay-cart"===a.action?(m.push(a.this_royalty),m.push(a.cart_total),m.push(a.amount)):"ask-monthly"===a.action||("set-monthly"===a.action?m.push(a.monthly):"ask-for-pan"===a.action||"got-pan"===a.action||"have-pan"===a.action||"cancel-pay"===a.action||"whats-this"===a.action||("payment-success"===a.action?(m.push(a.amount),m.push(a.payment_id),m.push(a.ptype)):"stats"===a.action?(m.push(a.site_visits),m.push(a.site_seconds),m.push(a.last_visit)):"c-stats"===a.action?(m.push(a.channel_visits),m.push(a.last_visit)):"load"===a.action||("subscribe"===a.action?m.push(a.payment_id):"open-cta"===a.action||("shopping-cart"===a.action?(m.push(a.payment_id),m.push(a.to),m.push(md5(a.url)),m.push(a.amt)):"subscription-success"===a.action?m.push(a.payment_id):"first-time-user"===a.action||a.action)))))),["plugin","youtube","facebook"].indexOf(l)>-1&&m.push(encodeURIComponent(Plugin.app.parsedParams.content_url));var n=m.join(",")+"\n";if(b){var o=new AWS.Kinesis({region:"eu-west-1"});o.putRecord({StreamName:"eventstream",PartitionKey:c,Data:n},function(){})}}},this.shouldHide=function(){if(this.last_payment_date=Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:last_payment_date")||null,this.last_payment_type=Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:last_payment_type")||null,this.last_payment_amt=Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:last_payment_amt")||0,this.last_payment_to=Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:last_payment_to")||null,this.configMgr.getConfigVal("hideAfterPayment")&&this.parsedParams.ownerid===this.last_payment_to&&"plugin"===this.parsedParams.channel){var a=(new Date).valueOf(),b=864e5;if(this.last_payment_amt>1e4&&this.last_payment_amt<1e5&&a-this.last_payment_date<=15*b)return!0;if(this.last_payment_amt>=1e5&&this.last_payment_amt<5e5&&a-this.last_payment_date<=30*b)return!0;if(this.last_payment_amt>=5e5&&a-this.last_payment_date<=60*b)return!0}return!1},this.getPollResults=function(a,b){var c,d=new XMLHttpRequest;c=this.localhost?"http://localhost:9005/poll-results/":"https://plugin.orcsnet.com/poll-results/",d.open("GET",c+"result."+a+".json",!0),d.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){if(this.responseText.trim()){var a=JSON.parse(this.responseText.trim());b&&b(a)}}else b&&b({})},d.send()},this.submitPollResponse=function(a,b,c){var d={cmpuid:AWS.config.credentials.identityId,pollname:a,pollrsp:b};Plugin.app.storage.localStorageAvailable&&localStorage.setItem("orcsnet:poll:"+a,b),Plugin.log("sending: "+JSON.stringify(d));var e=new AWS.SQS({region:"ap-south-1"});e.sendMessage({QueueUrl:"https://ap-south-1.queue.amazonaws.com/084183956366/poll-responses",MessageBody:JSON.stringify(d)},function(a,b){c&&c()})},this.loadAllInOne=function(){this.shouldHide()||(this.currentView&&this.currentView.close(),this.currentView=null,this.currentView=new Plugin.Views.AllInOne({el:document.getElementById("orcsnet")}),this.currentView.render())},this.loadUxv2=function(){this.currentView&&this.currentView.close(),this.currentView=null,this.currentView=new Plugin.Views.Uxv2({el:document.getElementById("orcsnet")}),this.currentView.render()},this.loadSupportKL=function(){this.currentView&&this.currentView.close(),this.currentView=null,this.currentView=new Plugin.Views.SupportKL({el:document.getElementById("orcsnet")}),this.currentView.render()},this.loadSupportTheWire=function(){this.currentView&&this.currentView.close(),this.currentView=null,this.currentView=new Plugin.Views.SupportTheWire({el:document.getElementById("orcsnet")})},this.loadSupportPage=function(){this.currentView&&this.currentView.close(),this.currentView=null,this.currentView=new Plugin.Views.SupportPage({el:document.getElementById("orcsnet")})},this.loadSubscriptionManagement=function(){this.currentView&&this.currentView.close(),this.currentView=null,"lookup"===this.parsedParams.subscriptionManagement.action?(this.currentView=new Plugin.Views.LookupSubscription({el:document.getElementById("orcsnet")}),this.currentView.subid=this.parsedParams.subscriptionManagement.subid||null,this.currentView.startup()):"cancel"===this.parsedParams.subscriptionManagement.action?(this.currentView=new Plugin.Views.CancelSubscription({el:document.getElementById("orcsnet")}),this.currentView.subid=this.parsedParams.subscriptionManagement.subid,this.currentView.token=this.parsedParams.subscriptionManagement.token||null,this.currentView.startup()):console.log("unknown value for action: "+this.parsedParams.subscriptionManagement.action)},this.checkFirstTimeUser=function(a){this.parsedParams.localStorageAvailable&&(Plugin.log("[Plugin.app.checkFirstTimeUser]"),window.localStorage.getItem("orcsnet:firstTimeClicked")||(window.localStorage.setItem("orcsnet:firstTimeClicked",1),this.firstTimeUser=!0,this.sendEvent_v2({action:"first-time-user"})))}}Plugin.Views=Plugin.Views||{},function(){"use strict";Plugin.Views.SupportKL=Backbone.NativeView.extend({initialize:function(){this.monthly=!1,Plugin.app.subconfigName="supportkl"},events:{"click #monthly":"toggleMonthly","click #makemonthly":"makeMonthly","click #makeonce":"makeOnce","click .pay-now":"payNow"},close:function(){this.stopListening(),this.unbind(),this.undelegateEvents()},render:function(){this.el.innerHTML=JST["app/scripts/templates/KhabarLahariya/SupportKL-2.ejs"].apply({monthly:this.monthly}),setTimeout(function(){Plugin.app.requestPositioning()},200)},renderThankYou:function(){this.el.innerHTML=JST["app/scripts/templates/KhabarLahariya/ThankYou.ejs"].apply({payment_id:this.payment_id,payment_type:this.payment_type,feeStruct:this.feeStruct,monthly:this.monthly})},toggleMonthly:function(a){this.monthly=!this.monthly,this.render()},makeMonthly:function(a){this.monthly=!0,this.render()},makeOnce:function(a){this.monthly=!1,this.render()},payNow:function(a){a.preventDefault();var b=a.delegateTarget||a.currentTarget||a.target,c=Number(b.getAttribute("data-amt"));document.getElementById("orcsnet").style.height="600px",setTimeout(function(){Plugin.log("sendScrollIntoView"),Plugin.app.sendScrollIntoView()},500),this.feeStruct=Plugin.app.payments.addFees(c),this.payment_type=this.monthly?"kl-monthly":"instant";var d={cmpuid:AWS.config.credentials.identityId.replace("ap-south-1:","").replace(/-/g,""),pubname:Plugin.app.parsedParams.ownerid,channel:Plugin.app.parsedParams.channel,content_id:Plugin.app.parsedParams.content_url,configname:Plugin.app.subconfigName,button_amount:Math.round(100*this.feeStruct.button_amount),payment_type:this.payment_type},e=this,f=Plugin.app.payments.rpOptions({amount:Math.round(100*this.feeStruct.amount_to_pay),name:Plugin.app.configMgr.getConfigVal("ownerName"),description:"An Orcsnet partner website",image:Plugin.app.configMgr.getConfigVal("rplogoUrl"),ondismiss:function(){e.render()},notes:d,onsuccess:this.showReceipt.bind(this)}),g=new Razorpay(f);g.open()},showReceipt:function(a){this.payment_id=a,this.renderThankYou()}})}(),Plugin.Views=Plugin.Views||{},function(){"use strict";Plugin.Views.SupportTheWire=Backbone.NativeView.extend({initialize:function(){if(this.amount=Number(Plugin.app.parsedParams.theWireSupportPage.amount),this.amount<=0)return console.log("invalid amount provided"),void window.parent.postMessage({status:"failure",error:"invalid amount"},"https://thewire.in");if(this.firstName=Plugin.app.parsedParams.theWireSupportPage.firstName||"",this.lastName=Plugin.app.parsedParams.theWireSupportPage.lastName||"",this.firstName=this.firstName.trim(),this.lastName=this.lastName.trim(),!this.firstName&&!this.lastName)return console.log("need a name"),void window.parent.postMessage({status:"failure",error:"need a name"},"https://thewire.in");this.pan=Plugin.app.parsedParams.theWireSupportPage.pan||"",this.pan=this.pan.trim().toUpperCase();var a=!1;if(a){if(!this.pan)return console.log("need a pan"),void window.parent.postMessage({status:"failure",error:"need a pan"},"https://thewire.in");if(!this.isValidPan(this.pan))return console.log("invalid pan"),void window.parent.postMessage({status:"failure",error:"invalid pan"},"https://thewire.in")}if(this.email=Plugin.app.parsedParams.theWireSupportPage.email||"",this.email=this.email.trim(),!this.email)return console.log("need an email"),void window.parent.postMessage({status:"failure",error:"need an email"},"https://thewire.in");if(this.phone=Plugin.app.parsedParams.theWireSupportPage.phone||"",this.phone=this.phone.trim(),!this.phone)return console.log("need a phone"),
void window.parent.postMessage({status:"failure",error:"need a phone"},"https://thewire.in");switch(Plugin.app.subconfigName="SupportTheWire",this.frequency=Plugin.app.parsedParams.theWireSupportPage.frequency,"s"===this.frequency&&(this.frequency="single"),"m"===this.frequency&&(this.frequency="monthly"),"y"===this.frequency&&(this.frequency="yearly"),this.frequency){case"single":this.singlePayment();break;case"monthly":case"yearly":this.spellItOut();break;default:console.log("invalid frequency provided"),window.parent.postMessage({status:"failure",error:"invalid frequency"},"https://thewire.in")}},events:{"click .proceed":"subscribe","click .cancel":"cancelPayment"},spellItOut:function(){var a="ONE MONTH";"yearly"===this.frequency&&(a="ONE YEAR"),this.el.innerHTML=JST["app/scripts/templates/Standard/SubscriptionConfirmation.ejs"].apply({fontFamily:Plugin.app.configMgr.getConfigVal("fontFamily"),duration:a,logoUrl:Plugin.app.configMgr.getConfigVal("logoUrl"),bgColor:Plugin.app.configMgr.getConfigVal("theme-secondary")})},cancelPayment:function(a){window.parent.postMessage({status:"failure",error:"user changed mind"},"https://thewire.in")},showSuccessMessage:function(){this.el.innerHTML=JST["app/scripts/templates/TheWire/SubscriptionSuccess.ejs"].apply({email:this.email})},close:function(){this.stopListening(),this.unbind(),this.undelegateEvents()},isValidPan:function(a){if(!a)return!1;if(a=a.toUpperCase().replace(/ /g,""),10!==a.length)return!1;var b=a.substring(0,3),c=a.substring(3,4),d=a.substring(4,5),e=a.substring(5,9),f=a.substring(9,10),g=b&&b.match(/[A-Z]+/);if(!g)return!1;var g=c&&c.match(/[CPHFATBLJG]/);if(!g)return!1;var g=d&&d.match(/[A-Z]/);if(!g)return!1;var g=e&&e.match(/[0-9]+/);if(!g)return!1;var g=f&&f.match(/[A-Z]/);return g?!0:!1},singlePayment:function(){var a=this;Plugin.app.payments.payWithRazorpay_Spot({button_amount:this.amount,amount_to_pay:this.amount,payment_type:"instant",callbacks:{onsuccess:function(b){a.showSuccessMessage(),window.parent.postMessage({status:"success",response:b,ptype:"single"},"https://thewire.in")},ondismiss:function(){window.parent.postMessage({status:"failure",error:"user closed window"},"https://thewire.in")}},firstName:this.firstName,lastName:this.lastName,userpan:this.pan,email:this.email,phone:this.phone});var b=function(){var a=document.getElementsByClassName("razorpay-backdrop");a.length>0?(console.log("changing background of razorpay-backdrop"),a[0].style.background="lightgray"):setTimeout(b,100)};b()},subscribe:function(a){this.el.innerHTML=JST["app/scripts/templates/Standard/PleaseWait.ejs"].apply({fontFamily:Plugin.app.configMgr.getConfigVal("fontFamily"),logoUrl:Plugin.app.configMgr.getConfigVal("logoUrl"),bgColor:Plugin.app.configMgr.getConfigVal("theme-secondary")});var b=this;Plugin.app.payments.payWithRazorpay_SubMerchantAccountSubscription({plan_amount:this.amount,subscription_type:this.frequency,userpan:this.pan,firstName:this.firstName,lastName:this.lastName,email:this.email,phone:this.phone,callbacks:{onerror:function(a){console.log(a),window.parent.postMessage({status:"failure",error:"error",details:a},"https://thewire.in")},ondismiss:function(){window.parent.postMessage({status:"failure",error:"user closed window"},"https://thewire.in")},onsuccess:function(a){b.showSuccessMessage(),window.parent.postMessage({status:"success",response:a,ptype:"subscription"},"https://thewire.in")}}});var c=function(){var a=document.getElementsByClassName("razorpay-backdrop");a.length>0?(console.log("changing background of razorpay-backdrop"),a[0].style.background="lightgray"):setTimeout(c,100)};c()}})}(),Plugin.Views=Plugin.Views||{},function(){"use strict";Plugin.Views.SupportPage=Backbone.NativeView.extend({initialize:function(){if(this.origin=Plugin.app.configMgr.getConfigVal("contentUrl"),this.amount=Number(Plugin.app.parsedParams.supportPage.amount),this.amount<=0)return console.log("invalid amount"),void window.parent.postMessage({status:"failure",error:"invalid amount"},this.origin);if(this.supporterName=Plugin.app.parsedParams.supportPage.supporterName||"",this.supporterName=this.supporterName.trim(),!this.supporterName)return console.log("need a name"),void window.parent.postMessage({status:"failure",error:"need a name"},this.origin);if(this.email=Plugin.app.parsedParams.supportPage.email||"",this.email=this.email.trim(),!this.email)return console.log("need an email"),void window.parent.postMessage({status:"failure",error:"need an email"},this.origin);if(this.phone=Plugin.app.parsedParams.supportPage.phone||"",this.phone=this.phone.trim(),!this.phone)return console.log("need a phone"),void window.parent.postMessage({status:"failure",error:"need a phone"},this.origin);switch(Plugin.app.subconfigName="SupportPage",this.frequency=Plugin.app.parsedParams.supportPage.frequency,"s"===this.frequency&&(this.frequency="single"),"m"===this.frequency&&(this.frequency="monthly"),"y"===this.frequency&&(this.frequency="yearly"),this.frequency){case"single":this.singlePayment();break;case"monthly":case"yearly":this.spellItOut();break;default:console.log("invalid frequency provided"),window.parent.postMessage({status:"failure",error:"invalid frequency"},this.origin)}},events:{"click .proceed":"subscribe","click .cancel":"cancelPayment"},spellItOut:function(){var a="ONE MONTH";"yearly"===this.frequency&&(a="ONE YEAR"),this.el.innerHTML=JST["app/scripts/templates/Standard/SubscriptionConfirmation.ejs"].apply({fontFamily:Plugin.app.configMgr.getConfigVal("fontFamily"),duration:a,logoUrl:Plugin.app.configMgr.getConfigVal("logoUrl"),bgColor:Plugin.app.configMgr.getConfigVal("theme-secondary")})},cancelPayment:function(a){window.parent.postMessage({status:"failure",error:"user changed mind"},this.origin)},showSuccessMessage:function(){},close:function(){this.stopListening(),this.unbind(),this.undelegateEvents()},singlePayment:function(){Plugin.app.payments.payWithRazorpay_Spot({button_amount:this.amount,amount_to_pay:this.amount,payment_type:"instant",supporterName:this.supporterName,email:this.email,phone:this.phone,callbacks:{onsuccess:function(a){view.showSuccessMessage(),window.parent.postMessage({status:"success",response:a,ptype:"single"},this.origin)},ondismiss:function(){window.parent.postMessage({status:"failure",error:"user closed window"},this.origin)}}});var a=function(){var b=document.getElementsByClassName("razorpay-backdrop");b.length>0?(console.log("changing background of razorpay-backdrop"),b[0].style.background="lightgray"):setTimeout(a,100)};a()},subscribe:function(){Plugin.app.payments.payWithRazorpay_SubMerchantAccountSubscription({plan_amount:this.amount,subscription_type:this.frequency,supporterName:this.supporterName,email:this.email,phone:this.phone,callbacks:{onerror:function(a){console.log(a),window.parent.postMessage({status:"failure",error:"error",details:a},this.origin)},ondismiss:function(){window.parent.postMessage({status:"failure",error:"user closed window"},this.origin)},onsuccess:function(a){view.showSuccessMessage(),window.parent.postMessage({status:"success",response:a,ptype:"subscription"},this.origin)}}});var a=function(){var b=document.getElementsByClassName("razorpay-backdrop");b.length>0?(console.log("changing background of razorpay-backdrop"),b[0].style.background="lightgray"):setTimeout(a,100)};a()}})}(),Plugin.Views=Plugin.Views||{},function(){"use strict";Plugin.Views.AllInOne=Backbone.NativeView.extend({cfg:function(a){return Plugin.app.configMgr.getConfigVal(a)},strval:function(a){return Plugin.app.configMgr.getStringVal(a)},RAND_INT:function(a){return Math.floor(Math.random()*Math.floor(a))},initialize:function(){this.listenTo(Plugin.app.unpaid,"add",this.render),this.listenTo(Plugin.app.unpaid,"remove",this.render),this.listenTo(Plugin.app.unpaid,"change",this.render);var a=this.cfg("messages");a||(a=[{lines:[{text:""}]}]),this.messageIdx=this.RAND_INT(a.length),this.messageToShow=a[this.messageIdx],this.buttons=this.cfg("buttons")||{config:{}},this.runPoll=!1,this.poll=null;var b=this.cfg("polls");if(b)for(var c=(new Date).valueOf(),d=0;d<b.length;++d){var e=b[d];if(e.start<=c&&c<=e.end){this.runPoll=!0,this.poll=e;break}}if(this.learnMore=this.cfg("learnMore"),this.learnMoreIdx=0,this.royalty=new Backbone.Model({to:Plugin.app.parsedParams.ownerid,toName:encodeURIComponent(this.cfg("showName")||this.cfg("ownerName")),url:Plugin.app.parsedParams.content_url,amt:0,dm:(new Date).valueOf(),midx:this.messageIdx}),this.calcPublisherTotals(),this.userphone=Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:userphone")||null,this.useremail=Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:useremail")||null,this.usermethod=Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:usermethod")||"card",this.userpansubmitted=Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:userpansubmitted")||!1,this.feeStruct={},this.payment_type=null,this.show={},this._set_all_false(),this.show.cta=!0,this.runPoll){var f=Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.getItem("orcsnet:poll-")+this.poll.name||null;if(f){var g=this;setTimeout(function(){var a=new AWS.Lambda({region:"ap-south-1"});a.invoke({FunctionName:"PollResults",Payload:JSON.stringify({pollName:g.poll.name,action:"get-results"})},function(a,b){g.parsePollResults(a,b)})},500)}else this._set_all_false(),this.show.pollQuestions=!0}this.currentUDAmtIdx=0,this.listenTo(this.royalty,"change",this.render),this.updateCart()},_set_all_false:function(){this.show.cta=!1,this.show.edit_royalty=!1,this.show.user_info=!1,this.show.ask_monthly=!1,this.show.learn_more=!1,this.show.thank_you=!1,this.show.pollQuestions=!1,this.show.pollResults=!1,this.show.youtubeplaylist=!1,this.show.invoice=!1,this.show.nologo=!1,this.show.maybesubscribe=!1,this.show.try_razorpay=!1},events:{"click .add-to-cart":"addToCart","click .open-dashboard":"openDashboard","click .incr":"incr","click .decr":"decr","click .cancel-royalty":"cancelRoyalty","click .clear-from-cart":"clearFromCart","click .close-dashboard":"closeDashboard","click .get-user-info":"getUserInfo","click .save-user-info":"saveUserInfo","click .select-method":"selectMethod","click .toggle-monthly":"toggleMonthly","click .set-amount":"setAmount","click .pay-unpaid":"payUnpaid","click .insta-pay":"instaPay","click .set-amt-and-pay":"setAmountAndPay","click .really-pay":"doPayment","click .init-pay":"initPayment","click .close-after-payment":"closeAfterPayment","click .poll-after-payment":"pollAfterPayment","click .ud-up":"incrUDAmt","click .ud-down":"decrUDAmt","click .whats-this":"whatsThis","click .poll-response":"pollResponse","click .poll-submit":"pollSubmit","click .show-invoice":"showInvoice","click .show-youtubeplaylist":"showYouTubePlaylist","click .pay-custom":"payAmount","click .pay-with-razorpay":"tryAgain"},close:function(){this.stopListening(),this.unbind(),this.undelegateEvents()},calcBaseAmount:function(){var a=this.royalty.get("amt");return Plugin.app.unpaid.forEach(function(b){b.get("to")===Plugin.app.parsedParams.ownerid&&(a+=b.get("amt"))}),a},render:function(){this.calcPublisherTotals(),("shopping-cart"===this.payment_type||null===this.payment_type)&&(this.feeStruct=Plugin.app.payments.addFees(this.calcBaseAmount()));var a=window.innerWidth<450;"samachara"===Plugin.app.parsedParams.ownerid&&(a=window.innerWidth<800);var b=this.cfg("orientation");a&&(b="portrait"),this.show.edit_royalty&&(b="portrait");var c=!!this.cfg("hideLogoPortrait"),d=!!this.cfg("hideLogoLandscape"),e=this.cfg("theme-primary"),f=this.cfg("theme-secondary"),g=f,h=e,i=g,j=g,k=this.cfg("btnBrdrWth"),l="",m="1px solid lightgray",n="black",o=this.cfg("borderDef"),p="grey",q=null,r=g,s=g,t="comp.cta.landscape",u="comp.cta.portrait",v=this.cfg("uxTheme"),w=this.strval("pgFeesExtra"),x=null,y=this.cfg("colorTheme");if("theme-1"===y){var z=e,A=f;g=A,h=z,i=A,j=A,k="1px",r=A}if("theme-2"===y){var z=e,A=f;g=A,h=z,i=A,j=A,k="1px",m="2px solid "+A,n=A,o="border: 2px solid "+A+"; border-radius: 3px;",p=A,q=z,r=A,s=z}if("theme-3"===y){var z=e,A=f;g=A,h=z,i=A,j=A,k="1px",q=z,r=z}var B="padding: 5px;";B+="text-align: center;",B+=a?"font-size: 12px;":"font-size: 18px;",B+="cursor: pointer;",B+="border-style: solid; ",B+="border-radius: 3px;",B+="max-width: 150px;",B+="margin-left: 10px; margin-right: 10px;",B+="width: 20%;",B+="display: flex;",B+="flex-direction: column;",B+="justify-content: center;",B+="align-items: center;",B+="color: "+h+"; ",B+="background-color: "+i+"; ",B+="border-color: "+j+"; ",B+="border-width: "+k+"; ";var C="padding: 5px;";C+="text-align: center;",C+=a?"font-size: 12px;":"font-size: 18px;",C+="cursor: pointer;",C+="border-style: solid; ",C+="border-radius: 3px;",C+="color: "+h+"; ",C+="background-color: "+i+"; ",C+="border-color: "+j+"; ",C+="border-width: "+k+"; ";var D="padding: 5px;";D+="text-align: center;",D+="font-size: 18px;",D+="cursor: pointer;",D+="margin: 0px auto;",D+="color: grey;","cta-no-border"===v&&(t="comp.cta.noborder",u="comp.cta.noborder",d=!0,c=!0,o="",w=""),"cta-no-border-with-a-pic"===v&&(t="comp.cta.noborderwithapic",u="comp.cta.noborderwithapic",d=!0,c=!0,o="",w="",x="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRJRHSJ54u0qnr9FFcXiHT3P0_DKDjlfM5wGAU6fbxaLHteiO-F"),"cta-fixed-plus-custom"===v&&(t="comp.cta.fixedpluscustom.landscape",u="comp.cta.fixedpluscustom.portrait");var E={ui:{fontFamily:this.cfg("fontFamily"),fontWt:this.cfg("fontWt"),uxBorderDef:o,outerPadding:this.cfg("outerPadding"),gearColor:p,cta_text_color:n,pgExtraMT:this.cfg("pgExtraMT")||"20"},data:{orientation:b,show:this.show,royalty:this.royalty.toJSON(),increment:Number(this.buttons.config.increment),ptotals:this.ptotals,feeStruct:this.feeStruct,learnMoreMsg:this.learnMore[this.learnMoreIdx],hideLogoLandscape:d,hideLogoPortrait:c},strings:{pgFeesExtra:w},templates:{}},F=function(a){return JST["app/scripts/templates/Standard/"+a+".ejs"]};if("portrait"!==b||c||(E.templates.portraitLogo=F("comp.logo.portrait").apply({ui:{headerHt:this.cfg("headerHt"),headerImgHt:this.cfg("headerImgHt"),headerBrdDef:l,logo_background_color:r,link_background_color:s,link_text_color:n,imgBg:q},data:{logoUrl:this.cfg("logoUrl")},strings:{partnerLink:this.strval("partnerLink")}})),"landscape"===b&&this.show.cta&&(d||(E.templates.landscapeLogo=F("comp.logo.landscape").apply({ui:{logo_background_color:r,leftImgHt:this.cfg("leftImgHt"),imgBg:q,containerHt:this.cfg("containerHt")},data:{logoUrl:this.cfg("logoUrl")}})),E.templates.landscapeCTA=F(t).apply({ui:{style_action_btn:B,style_subtle_btn:D,cta_text_color:n,solid_color:g,cta_hr_mt:this.cfg("cta_hr_mt"),cta_hr_def:m,cta_tnc_mrt:this.cfg("cta_tnc_mrt"),msgLineHeight:this.cfg("cta_left_lh"),fontWt:this.cfg("fontWt"),fontSize:this.cfg("leftCTAFtSz"),gearColor:p,style_action_btn_withapic:C,imgUrl:x,noborder_ff_btns:this.cfg("noborder.buttons.fontfamily")},data:{messageToShow:this.messageToShow,cta_show_cart:this.ptotals.length>0||this.royalty.get("amt")>0,increment:Number(this.buttons.config.increment),amounts:this.buttons.config.amounts,incrementText:this.buttons.config.incrementText,amountsText:this.buttons.config.amountsText,subscriptions:this.cfg("subscriptions")},strings:{rupeeSymbol:this.strval("rupeeSymbol"),pgFeesExtra:this.strval("pgFeesExtra")}})),"portrait"===b&&this.show.cta&&(E.templates.portraitCTA=F(u).apply({ui:{style_action_btn:B,style_subtle_btn:D,updown_stroke:e,updown_fill:g,solid_color:g,fontWt:this.cfg("fontWt"),fontSize:this.cfg("headerCTAFtSz"),cta_text_color:n,ctaMarginTop:this.cfg("ctaMarginTop"),ctaMarginBottom:this.cfg("ctaMarginBottom"),style_action_btn_withapic:C,imgUrl:x,noborder_ff_btns:this.cfg("noborder.buttons.fontfamily")},data:{messageToShow:this.messageToShow,cta_show_cart:this.ptotals.length>0||this.royalty.get("amt")>0,increment:Number(this.buttons.config.increment),incrementText:this.buttons.config.incrementText,amounts:this.buttons.config.amountsRow1||this.buttons.config.amounts,amountsRow2:this.buttons.config.amountsRow2,amountsRow2Text:this.buttons.config.amountsRow2Text,amountsText:this.buttons.config.amountsText,upDownAmounts:this.buttons.config.upDownAmounts,currentUDAmtIdx:this.currentUDAmtIdx,subscriptions:this.cfg("subscriptions")},strings:{rupeeSymbol:this.strval("rupeeSymbol"),pgFeesExtra:this.strval("pgFeesExtra")}})),this.show.try_razorpay&&(E.templates.tryAgain=F("comp.tryagain").apply({ui:{style_action_btn:B,button_fill:f},data:{feeStruct:this.feeStruct},strings:{rupeeSymbol:this.strval("rupeeSymbol")}})),this.show.thank_you&&(E.templates.thankYou=F("comp.thankyou").apply({ui:{button_text_color:e,button_fill:f},data:{payment_id:this.payment_id,payment_type:this.payment_type,subscriptionType:this.subscriptionType,feeStruct:this.feeStruct,ownerName:this.cfg("ownerName")},strings:{thankYou:this.strval("thankYou")}})),this.show.invoice&&(E.templates.invoice=F("comp.invoice").apply({ui:{button_text_color:e,button_fill:f},data:{payment_id:this.payment_id,payment_type:this.payment_type,subscriptionType:this.subscriptionType,feeStruct:this.feeStruct,ownerName:this.cfg("ownerName")},strings:{thankYou:this.strval("thankYou")}})),this.show.youtubeplaylist){var G=this.cfg("ytplaylists");if(G.length>0){var H=this.RAND_INT(G.length),I=G[H];E.templates.youtubePlaylist=F("comp.youtubeplaylist").apply({ui:{button_text_color:e,button_fill:f},data:{playListUrl:I.playListUrl,playListTitle:I.playListTitle,playListImgUrl:I.playListImgUrl},strings:{thankYou:this.strval("thankYou")}})}else this.show.youtubeplaylist=!1}if(this.show.pollQuestions&&this.poll&&(E.templates.portraitPollQ=F("comp.poll.questions.portrait").apply({ui:{style_action_btn:B,style_subtle_btn:D},data:{poll:this.poll},strings:{}})),this.show.pollResults&&this.poll&&(E.templates.portraitPollR=F("comp.poll.results.portrait").apply({data:{poll:this.poll,pollResults:this.pollResults}})),"landscape"===b&&(E.templates.landscapeActions=F("comp.actionsrow.landscape").apply({ui:{cta_text_color:n,gearColor:p},data:{feeStruct:this.feeStruct},strings:{pgFeesExtra:this.strval("pgFeesExtra"),rupeeSymbol:this.strval("rupeeSymbol")}})),"portrait"===b&&(E.templates.portraitActions=F("comp.actionsrow.portrait").apply({ui:{cta_text_color:n,gearColor:p},data:{feeStruct:this.feeStruct},strings:{rupeeSymbol:this.strval("rupeeSymbol")}})),this.show.user_info&&(E.templates.userInfo=F("comp.userinfo").apply({ui:{style_action_btn:B,style_subtle_btn:D,fontFamily:this.cfg("fontFamily"),fontWt:this.cfg("fontWt"),underlinecolor:g},data:{userphone:this.userphone,useremail:this.useremail,usermethod:this.usermethod}})),this.show.maybesubscribe&&(E.templates.maybeSubscribe=F("comp.subscription.kyc").apply({ui:{text_color:g,underline_color:g,checkmark_stroke_color:g,style_action_btn:B,style_subtle_btn:D},data:{feeStruct:this.feeStruct,need_pan:this.doWeNeedPAN()&&!this.userpan&&!this.userpansubmitted,payment_type:this.payment_type,subscriptionType:this.subscriptionType,editing_amount:this.editing_amount},strings:{monthly:this.strval("monthly"),annual:this.strval("annual"),oneTime:this.strval("oneTime"),autodebit:this.strval("autodebit")}})),this.show.ask_monthly&&(E.templates.askMonthly=F("comp.askmonthly").apply({ui:{underline_color:g,checkmark_stroke_color:g,style_action_btn:B,style_subtle_btn:D},data:{payment_type:this.payment_type,feeStruct:this.feeStruct},strings:{cancel:this.strval("cancel"),rupeeSymbol:this.strval("rupeeSymbol")}})),this.show.edit_royalty&&this.ptotals.length>0&&(E.templates.publisherTotals=F("comp.publishertotals").apply({data:{ptotals:this.ptotals},strings:{pending:this.strval("pending"),rupeeSymbol:this.strval("rupeeSymbol")}})),this.show.edit_royalty&&(E.templates.payNowPayLater=F("comp.paynowpaylater").apply({ui:{button_text_color:h,style_action_btn:B,style_subtle_btn:D},data:{feeStruct:this.feeStruct},strings:{saveForLater:this.strval("saveForLater"),close:this.strval("close"),rupeeSymbol:this.strval("rupeeSymbol"),pgCosts:this.strval("pgCosts")}})),this.show.edit_royalty&&(E.templates.thisRoyalty=F("comp.thisroyalty").apply({ui:{plusminus_bg:f,plusminus_fg:e},data:{royalty:this.royalty.toJSON()},strings:{rupeeSymbol:this.strval("rupeeSymbol"),forThisArticle:this.strval("forThisArticle")}})),this.el.innerHTML=F("ux.allinone").apply(E),setTimeout(function(){Plugin.app.requestPositioning()},200),!this.editing_amount){var J=this,K=document.getElementById("amount-input");K&&K.addEventListener("focus",function(a){J.editing_amount=!0,J.render();var b=document.getElementById("amount-input");b.focus(),b.selectionStart=b.selectionEnd=b.value.length})}var K=document.getElementById("amount-input");if(K){var J=this;K.addEventListener("change",function(a){J.setAmount(a)})}},tryAgain:function(a){this.payWithRazorpay_Spot(a)},payAmount:function(a){var b=document.getElementById("custom-amt"),c=Number(b.value);return 5>c||c>5e3?void(b.value=""):(this.payment_type="instant",this.subscriptionType=null,this.feeStruct=Plugin.app.payments.addFees(c),void(0!==this.feeStruct.base_amount&&this.doPayment(a)))},setAmount:function(a){a.preventDefault();var b=document.getElementById("amount-input");if(""===b.value)return this.editing_amount=!1,void this.render();var c=Number(b.value),d=1e4;this.cfg("submerchant_key")&&(d=15e4),c>0&&d>c?("shopping-cart"===this.payment_type?(this.royalty.set({amt:c}),this.feeStruct=Plugin.app.payments.addFees(c)):"once"===this.subscriptionType?this.feeStruct=Plugin.app.payments.addFees(c):this.feeStruct={base_amount:c,fees:0,amount_to_pay:c,button_amount:c},this.editing_amount=!1,this.render()):(b.value="",b.focus())},incrUDAmt:function(a){this.currentUDAmtIdx=Math.min(this.buttons.config.upDownAmounts.length-1,this.currentUDAmtIdx+1);var b=document.getElementById("ud-insta-pay"),c=String(this.buttons.config.upDownAmounts[this.currentUDAmtIdx]);b.innerHTML="₹"+c,b.setAttribute("data-amt",c)},decrUDAmt:function(a){this.currentUDAmtIdx=Math.max(0,this.currentUDAmtIdx-1);var b=document.getElementById("ud-insta-pay"),c=String(this.buttons.config.upDownAmounts[this.currentUDAmtIdx]);b.innerHTML="₹"+c,b.setAttribute("data-amt",c)},pollResponse:function(a){a.preventDefault();var b=a.delegateTarget||a.currentTarget||a.target,c=Number(b.getAttribute("data-response"));this.poll.currentAnswerIdx=c,this.render()},pollSubmit:function(a){if(a.preventDefault(),this.poll.hasOwnProperty("currentAnswerIdx")){console.log("submitting answer "+String(this.poll.currentAnswerIdx)),Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.setItem("orcsnet:poll-"+this.poll.name,String(this.poll.currentAnswerIdx));var b=new AWS.Lambda({region:"ap-south-1"}),c=this,d={pollName:c.poll.name,action:"submit",response:c.poll.answers[c.poll.currentAnswerIdx].text};b.invoke({FunctionName:"PollResults",Payload:JSON.stringify(d)},function(a,b){c.parsePollResults(a,b)}),this._set_all_false(),this.show.pollResults=!0,this.show.cta=!0,this.render()}},parsePollResults:function(a,b){if(this.pollResults={},a)console.log(a);else{for(var c=JSON.parse(b.Payload),d=0;d<this.poll.answers.length;++d)this.pollResults[this.poll.answers[d].text]=0;for(var e in c)this.pollResults[e]=c[e]}this._set_all_false(),this.show.cta=!0,this.show.pollResults=!0,this.render()},showInvoice:function(a){this._set_all_false(),this.show.invoice=!0,this.show.nologo=!0,this.render()},showYouTubePlaylist:function(a){this._set_all_false(),this.show.youtubeplaylist=!0,this.show.nologo=!0,this.render()},whatsThis:function(a){this.show.learn_more?(this.learnMoreIdx++,this.learnMoreIdx>=this.learnMore.length?(this.show.learn_more=!1,this.learnMoreIdx=0,this.render()):document.getElementById("learn-more").innerHTML=this.learnMore[this.learnMoreIdx]):(this.show.learn_more=!0,this.learnMoreIdx=0,this.render())},incr:function(a,b){var c=this.royalty.get("amt"),d=Number(this.buttons.config.increment)||10;if(c+=d,1e3>=c)if(this.royalty.set({amt:c,dm:(new Date).valueOf()},{silent:!0}),b&&"add-to-cart"===b.from&&this.show.edit_royalty)this.render();else if(b&&"add-to-cart"===b.from&&this.show.cta)Plugin.app.storage.addEventToQ(this.royalty.toJSON()),this.updateCart();else if(c===d)this.render();else{var e=this.cfg("rupeeSymbol");document.getElementById("this-royalty-amt").innerHTML=e+String(c),this.calcPublisherTotals(),this.feeStruct=Plugin.app.payments.addFees(this.calcBaseAmount()),document.getElementById("pg-costs").innerHTML="<i>* PG COSTS: "+e+String(this.feeStruct.fees.toFixed(2))+"</i>",document.getElementById("really-pay-amt").innerHTML=e+String(this.feeStruct.amount_to_pay.toFixed(2)),document.getElementById("this-article-amt")&&(document.getElementById("this-article-amt").innerHTML=e+String(this.royalty.get("amt")))}},decr:function(a){if(0===this.feeStruct.amount_to_pay)this.closeDashboard();else{var b=Number(this.buttons.config.increment)||10,c=this.royalty.get("amt");if(c=Math.max(0,c-b),this.royalty.set({amt:c,dm:(new Date).valueOf()},{silent:!0}),c>0){var d=this.cfg("rupeeSymbol");document.getElementById("this-royalty-amt").innerHTML=d+String(c),this.calcPublisherTotals(),this.feeStruct=Plugin.app.payments.addFees(this.calcBaseAmount()),document.getElementById("pg-costs").innerHTML="<i>* PG COSTS: "+d+String(this.feeStruct.fees.toFixed(2))+"</i>",document.getElementById("really-pay-amt").innerHTML=d+String(this.feeStruct.amount_to_pay.toFixed(2)),document.getElementById("this-article-amt")&&(document.getElementById("this-article-amt").innerHTML=d+String(this.royalty.get("amt")))}else this.render()}},cancelRoyalty:function(a){0===this.royalty.get("amt")&&0===this.ptotals.length?this.closeDashboard():this.royalty.set("amt",0)},clearFromCart:function(a){for(var b=a.delegateTarget||a.currentTarget||a.target,c=Number(b.getAttribute("data-idx")),d=this.ptotals[c].pubid,e=Plugin.app.unpaid.toJSON(),f=0,c=0;c<e.length;c++){var g=e[c];g.to===d&&(f+=g.amt,g.amt=0,Plugin.app.storage.addEventToQ(g))}this.updateCart(),this.feeStruct=Plugin.app.payments.addFees(this.calcBaseAmount())},calcPublisherTotals:function(){for(var a={},b={},c=Plugin.app.unpaid.toJSON(),d=0;d<c.length;d++){var e=c[d].to;a.hasOwnProperty(e)||(a[e]=0),a[e]+=c[d].amt,b[e]=c[d].toName&&decodeURIComponent(c[d].toName)||e}this.ptotals=[];for(var e in a)this.ptotals.push({pubid:e,pubname:b[e],amt:a[e]})},openDashboard:function(a){this._set_all_false(),this.show.edit_royalty=!0,this.payment_type="shopping-cart",this.render()},payUnpaid:function(a){this.feeStruct=Plugin.app.payments.addFees(this.calcBaseAmount()),0!==this.feeStruct.base_amount&&(this.payment_type="shopping-cart",this.doPayment())},addToCart:function(a){a.preventDefault(),this.payment_type="shopping-cart",this.incr(a,{from:"add-to-cart"})},_reset:function(){this._set_all_false(),this.show.cta=!0,this.payment_type=null,this.subscriptionType=null,this.alreadySetAmt=!1},closeDashboard:function(a){if(!this.alreadySetAmt){this.payment_type;this._reset(),Plugin.app.storage.addEventToQ(this.royalty.toJSON()),this.updateCart(),this.feeStruct=Plugin.app.payments.addFees(this.calcBaseAmount())}},getUserInfo:function(a){this.savedShow?(this.show=JSON.parse(JSON.stringify(this.savedShow)),this.savedShow=null):(this.savedShow=JSON.parse(JSON.stringify(this.show)),this._set_all_false(),this.show.user_info=!0),this.render()},saveUserInfo:function(a){var b=document.getElementById("input-phone"),c=document.getElementById("input-email");if(b.value.trim()){var d=b.value.trim();Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.setItem("orcsnet:userphone",d),this.userphone!==d&&(this.userphone=d,Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.removeItem("orcsnet:userpansubmitted"),this.userpan=null)}if(c.value.trim()){var e=c.value.trim();Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.setItem("orcsnet:useremail",e),this.useremail!==e&&(this.useremail=e,Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.removeItem("orcsnet:userpansubmitted"),this.userpan=null)}this.savedShow?(this.show=JSON.parse(JSON.stringify(this.savedShow)),this.savedShow=null):this._reset(),this.render()},selectMethod:function(a){a.preventDefault();var b=a.delegateTarget||a.currentTarget||a.target;this.usermethod=b.getAttribute("data-method"),this.usermethod&&Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.setItem("orcsnet:usermethod",this.usermethod);var c=document.getElementById("input-phone"),d=document.getElementById("input-email"),e=c.value.trim()||this.userphone,f=d.value.trim()||this.useremail;e&&Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.setItem("orcsnet:userphone",e),f&&Plugin.app.parsedParams.localStorageAvailable&&window.localStorage.setItem("orcsnet:useremail",f),this.userphone=e,this.useremail=f,this.render()},instaPay:function(a){a.preventDefault();var b=a.delegateTarget||a.currentTarget||a.target,c=Number(b.getAttribute("data-amt")),d=b.getAttribute("data-subscription")&&"yes"===b.getAttribute("data-subscription");0!==c&&(d||this.cfg("alwaysSubscribe")?(this.payment_type="subscription",this.subscriptionType="monthly",this.feeStruct={base_amount:c,fees:0,amount_to_pay:c,button_amount:c}):(this.payment_type="instant",this.subscriptionType=null,this.feeStruct=Plugin.app.payments.addFees(Number(c))),0!==this.feeStruct.base_amount&&this.doPayment(a))},doWeNeedPAN:function(){return this.feeStruct.button_amount<1e3?!1:!!this.cfg("needPAN")},_isValidPan:function(a){if(!a)return!1;if(a=a.toUpperCase().replace(/ /g,""),10!==a.length)return!1;var b=a.substring(0,3),c=a.substring(3,4),d=a.substring(4,5),e=a.substring(5,9),f=a.substring(9,10),g=b&&b.match(/[A-Z]+/);if(!g)return!1;var g=c&&c.match(/[CPHFATBLJG]/);if(!g)return!1;var g=d&&d.match(/[A-Z]/);if(!g)return!1;var g=e&&e.match(/[0-9]+/);if(!g)return!1;var g=f&&f.match(/[A-Z]/);return g?!0:!1},_has_user_info:function(){return!!(this.useremail&&this.userphone&&this.usermethod)},setAmountAndPay:function(a){var b=document.getElementById("amount-input"),c=b.value;if(""!==c){var d=Number(c);if(10>d||d>15e4)return b.value="",void b.focus();this.feeStruct=Plugin.app.payments.addFees(d),this.alreadySetAmt=!0;var e=a.delegateTarget||a.currentTarget||a.target,f=e.getAttribute("data-type");"monthly"===f?(this.payment_type="subscription",this.subscriptionType="monthly"):"yearly"===f?(this.payment_type="subscription",this.subscriptionType="yearly"):(this.payment_type="instant",this.subscriptionType="once"),this.doPayment()}},doPayment:function(a){if(this.show.maybesubscribe===!1&&this.doWeNeedPAN())this._set_all_false(),this.show.maybesubscribe=!0,this.render();else if(this.show.maybesubscribe===!1&&this.cfg("subscriptions"))this._set_all_false(),this.show.maybesubscribe=!0,this.render();else if(this.show.maybesubscribe){if(!this.userpansubmitted){var b=document.getElementById("input-pan");if(b){var c=b.value.trim();if(!c||!this._isValidPan(c)){var d={"PAN number":"=> PAN number","Invalid PAN":"=> PAN number","=> PAN number":"=> PAN NUMBER! <=","=> PAN NUMBER! <=":"PAN number"};return b.value="",b.style.borderColor=this.cfg("themeColor"),c?b.placeholder="Invalid PAN":b.placeholder=d[b.placeholder],void(this.alreadySetAmt=!1)}this.userpan=c.toUpperCase().replace(/ /g,"")}}this.initPayment(a)}else this.cfg("askMonthly")?(this._set_all_false(),this.show.ask_monthly=!0,this.render()):(this._set_all_false(),this.initPayment(a))},toggleMonthly:function(a){var b=this.feeStruct.button_amount;switch(this.payment_type){case"instant":this.payment_type="subscription",this.subscriptionType="monthly",this.feeStruct={base_amount:b,fees:0,amount_to_pay:b,button_amount:b};break;case"subscription":this.payment_type="instant",this.subscriptionType=null,this.feeStruct=Plugin.app.payments.addFees(Number(b))}this.render()},initPayment:function(a){"paytm"===this.cfg("payment_gateway")?this.payWithPayTMSpot(a):this.cfg("submerchant_key")&&"subscription"===this.payment_type?this.payWithRazorpay_SubMerchantAccountSubscription(a):this.payWithRazorpay_Spot(a);
},payWithPayTMSpot:function(a){var b=this;Plugin.app.payments.payWithPayTMSpot({button_amount:this.feeStruct.button_amount,amount_to_pay:this.feeStruct.amount_to_pay,payment_type:this.payment_type,callbacks:{success:function(a){Plugin.log(a),b.afterPayment(a)},paytmfail:function(a){Plugin.log(a),Plugin.app.sendEvent_v2({action:"paytm-payment-failed",response_code:a}),b._set_all_false(),b.show.try_razorpay=!0,b.render()},otherfail:function(){Plugin.log("otherfail"),Plugin.app.sendEvent_v2({action:"paytm-payment-lambda-failed"}),b._set_all_false(),b.show.try_razorpay=!0,b.render()}}})},payWithRazorpay_Spot:function(a){Plugin.app.payments.payWithRazorpay_Spot({payment_type:this.payment_type,button_amount:this.feeStruct.button_amount,amount_to_pay:this.feeStruct.amount_to_pay,callbacks:{ondismiss:this.cancelPayment.bind(this),onsuccess:this.afterPayment.bind(this)},usermethod:this.usermethod,userpan:this.userpan})},payWithRazorpay_SubMerchantAccountSubscription:function(a){for(var b=document.getElementsByClassName("set-amt-and-pay"),c=0;c<b.length;c++){var d=b[c];d&&(d.innerHTML="...",d.style["background-color"]="rgb(202, 76, 78)",d.style["border-color"]="rgb(202, 76, 78)")}var e=document.getElementById("amount-input");e&&(e.disabled=!0,e.readOnly=!0);for(var f=document.getElementsByClassName("init-pay"),g=0;g<f.length;g++){var h=f[g];h&&(h.innerHTML="...",h.style["background-color"]="rgb(43, 85, 152)",h.style["border-color"]="rgb(43, 85, 152)"),this.alreadySetAmt=!0}Plugin.app.payments.payWithRazorpay_SubMerchantAccountSubscription({plan_amount:this.feeStruct.button_amount,subscription_type:this.subscriptionType||"monthly",callbacks:{ondismiss:this.cancelPayment.bind(this),onsuccess:this.afterPayment.bind(this),onerror:this.cancelPayment.bind(this)},userpan:this.userpan})},cancelPayment:function(){this._reset(),this.render()},afterPayment:function(a){Plugin.app.storage.flushQ(),this._set_all_false(),this.payment_id=a,"youtubeplaylist"===this.cfg("afterPayment")?this.showYouTubePlaylist():(this.show.thank_you=!0,this.payment_type="instant",this.updateCart())},closeAfterPayment:function(a){Plugin.app.backToFront()},pollAfterPayment:function(a){var b=a.delegateTarget||a.currentTarget||a.target;b.getAttribute("data-response")||"no";this.show.responded=!0,this.render()},updateCart:function(){Plugin.app.unpaid.reset(Plugin.app.storage.getCurrentState());var a=Plugin.app.unpaid.findIndex({url:this.royalty.get("url")});if(a>-1){var b=Plugin.app.unpaid.at(a);this.royalty.set(b.toJSON(),{silent:!0}),Plugin.app.unpaid.remove(b)}else this.royalty.set({amt:0},{silent:!0});this.render()}})}(),Plugin.Views=Plugin.Views||{},function(){"use strict";Plugin.Views.Uxv2=Backbone.NativeView.extend({RAND_INT:function(a){return Math.floor(Math.random()*Math.floor(a))},initialize:function(){var a=window.innerWidth<450;if("samachara"===Plugin.app.parsedParams.ownerid&&(a=window.innerWidth<800),this.orientation="landscape",a&&(this.orientation="portrait_small",Plugin.app.configMgr.getConfigVal("uxv2.orientation-on-mobile")&&(this.orientation=Plugin.app.configMgr.getConfigVal("uxv2.orientation-on-mobile"))),Plugin.app.configMgr.getConfigVal("uxv2.orientation")&&(this.orientation=Plugin.app.configMgr.getConfigVal("uxv2.orientation")),"portrait_tall"===Plugin.app.parsedParams.orientation&&(this.orientation="portrait_tall"),"portrait_small"===Plugin.app.parsedParams.orientation&&(this.orientation="portrait_small"),this.strings={support:Plugin.app.configMgr.getStringVal("support"),tryAnother1:Plugin.app.configMgr.getStringVal("tryAnother1"),tryAnother2:Plugin.app.configMgr.getStringVal("tryAnother2"),thankYou:Plugin.app.configMgr.getStringVal("thankYou"),cta:Plugin.app.configMgr.getStringVal("cta")},this.flow=Plugin.app.configMgr.getUxv2Flow(),Plugin.app.configMgr.getConfigVal("uxv2.ptall.topbg"))for(var b in this.flow.transitions)this.flow.transitions[b].ui=this.flow.transitions[b].ui||{},this.flow.transitions[b].ui.ptall_topbg="background-color: "+Plugin.app.configMgr.getConfigVal("uxv2.ptall.topbg")+";",this.flow.transitions[b].ui.ptall_topbg+="margin-bottom: 20px; ";if(Plugin.app.configMgr.getConfigVal("uxv2.ptall.logoht"))for(var b in this.flow.transitions)this.flow.transitions[b].ui=this.flow.transitions[b].ui||{},this.flow.transitions[b].ui.ptall_logoht="height: "+Plugin.app.configMgr.getConfigVal("uxv2.ptall.logoht")+";";if(this.tmpl_dir="UXv2",Plugin.app.configMgr.getConfigVal("uxv2.templatelocation")&&(this.tmpl_dir=Plugin.app.configMgr.getConfigVal("uxv2.templatelocation")),this.state={rot:1,assetHt:"100",logoUrl:Plugin.app.configMgr.getConfigVal("logoUrl"),showAnnual:!!Plugin.app.configMgr.getConfigVal("uxv2.showannual"),strings:this.strings,ui:{},amount:null,ptype:"instant",feeStruct:{}},Plugin.app.configMgr.getConfigVal("uxv2.startingamount")?this.state.amount=Number(Plugin.app.configMgr.getConfigVal("uxv2.startingamount")):this.setRotStart(),this.screen=this.flow.start,Plugin.app.configMgr.getConfigVal("poll")){var c=Plugin.app.configMgr.getConfigVal("poll");this.pollName=c.pollName,this.screen="p_pollq",this.orientation="landscape",Plugin.app.storage.localStorageAvailable&&(this.state.polla=localStorage.getItem("orcsnet:poll:"+this.pollName))}},setRotStart:function(){var a=this.flow.transitions.p_amtselection&&this.flow.transitions.p_amtselection.rot_start;null!==a&&void 0!==a&&(this.state.rot=["lo","mid","hi"].indexOf(a))},events:{"click .c_ctrl":"clickHandler"},close:function(){this.stopListening(),this.unbind(),this.undelegateEvents()},t:function(a){return JST["app/scripts/templates/"+this.tmpl_dir+"/ux.uxv2."+this.orientation+"."+this.screen+".ejs"]},render:function(a){if("p_kyc"===this.screen||"p_kyc_1"===this.screen){var b=Plugin.app.configMgr.getConfigVal("needpanabove");b&&(this.state.need_pan=this.state.feeStruct.amount_to_pay>=Number(b))}if(this.flow.transitions[this.screen].hasOwnProperty("amounts")&&(this.state.amounts=this.flow.transitions[this.screen].amounts),this.flow.transitions[this.screen].hasOwnProperty("amount")&&(this.state.amount=this.flow.transitions[this.screen].amount),this.flow.transitions[this.screen].hasOwnProperty("cta1")&&(this.state.cta1=this.flow.transitions[this.screen].cta1),this.flow.transitions[this.screen].hasOwnProperty("cta")&&(this.state.cta=this.flow.transitions[this.screen].cta),"p_pollq"===this.screen&&(this.state.poll_question=this.flow.transitions.p_pollq.question,this.state.poll_answers=this.flow.transitions.p_pollq.answers,this.state.polla))return void this.showPollResults();this.state.has_next=!!this.flow.transitions[this.screen].c_next,this.state.has_back=!!this.flow.transitions[this.screen].c_back,this.state.ui={},this.state.ui.imgstyle="height: 140px;",this.state.ui.fgcolor=Plugin.app.configMgr.getConfigVal("fgColor")||"white",this.state.ui.bgcolor=Plugin.app.configMgr.getConfigVal("bgColor")||Plugin.app.configMgr.getConfigVal("rpColor");var c=function(a,b){if(b.hasOwnProperty("ui"))for(var c in b.ui)b.ui.hasOwnProperty(c)&&(a.ui[c]=b.ui[c])};c(this.state,Plugin.app.configMgr.scfg),c(this.state,this.flow.transitions[this.screen]),console.log("Plugin.render using ui:"),console.log(this.state.ui),this.el.innerHTML=this.t(this.screen).apply(this.state),setTimeout(Plugin.app.requestPositioning.bind(Plugin.app),200);var d=function(a,b,c){return function(){for(var d=document.getElementsByClassName(a),e=0;e<d.length;e++)d[e].style[b]=c}},e=function(a){return function(){var b=document.getElementsByClassName(a);if(2===b.length){var c=b[0].getClientRects()[0].height,d=b[1].getClientRects()[0].height;c>d&&(b[1].style.height=String(c)+"px"),d>c&&(b[0].style.height=String(d)+"px")}}};if(setTimeout(d("fade-in","opacity","1"),0),setTimeout(d("shrinking-border","border-radius","3px"),0),setTimeout(e("grow-height"),10),"p_gotopg"===this.screen&&this.initPayment(a),"p_cta_2"===this.screen){var f=this,g=function(){var a=document.getElementById("amount-input");if(a&&a.value){var b=Number(a.value);b>0?b>10&&(f.state.amount=b,document.getElementById("button-amount").innerHTML="₹"+String(b)):a.value=""}};this.checkInputTimer=setInterval(g,200)}else this.checkInputTimer&&(clearInterval(this.checkInputTimer),this.checkInputTimer=null);if("p_polla"===this.screen)for(var h in this.state.poll_result_bar_width)setTimeout(d("growing-bar-"+h,"width",String(this.state.poll_result_bar_width[h])+"%"),0)},clickHandler:function(a){var b=a.delegateTarget||a.currentTarget||a.target,c=b.getAttribute("data-ctrl");switch(c){case"transition":var d=b.getAttribute("data-to");"c_back"===d&&"p_amtselection"===this.screen&&(this.state.amount=null),"c_back"===d&&"p_methodselection"===this.screen&&(this.state.retrying=!1),"c_back"===d&&"p_methodselection_1"===this.screen&&(this.state.retrying=!1),d&&(this.screen=this.flow.transitions[this.screen][d],this.setRotStart(),this.render());break;case"rot":this.state.rot++,this.render();break;case"amt.left":this.state.rot>0&&(this.state.rot--,this.render());break;case"amt.right":this.state.rot<2&&(this.state.rot++,this.render());break;case"select-ptype":this.state.ptype=b.getAttribute("data-ptype"),this.setFees(),this.screen=this.flow.transitions[this.screen].c_next,this.render();break;case"select-ptype-and-amt-0":this.state.ptype=b.getAttribute("data-ptype"),this.state.amount=Number(b.getAttribute("data-amt")),this.setFees(),this.screen=this.flow.transitions[this.screen].c_sub_next,this.render();break;case"select-ptype-and-amt":this.state.ptype=b.getAttribute("data-ptype");var e=Number(document.getElementById("amount-input").value);e=Math.round(e,0);var f=Number(Plugin.app.configMgr.getConfigVal("uxv2.lowerlimit"))||100,g=Number(Plugin.app.configMgr.getConfigVal("uxv2.upperlimit"))||1e4;if(f>e||e>g)return document.getElementById("amount-input").value="",void(document.getElementById("amount-input").placeholder=String(f)+" to "+String(g));this.state.amount=e,this.setFees(),this.screen=this.flow.transitions[this.screen].c_next,this.render();break;case"select-amt":this.state.amount=Number(b.getAttribute("data-amt")),this.setFees(),this.screen=this.flow.transitions[this.screen].c_next,this.render();break;case"select-method":this.state.method=b.getAttribute("data-method"),this.screen=this.flow.transitions[this.screen].c_next,this.render(a);break;case"try-razorpay":this.payWithRazorpay_Spot(a);break;case"verify-pan":var h=document.getElementById("input_pan"),i=h.value.trim();i?this.isValidPan(i)?(this.userpan=i.toUpperCase(),this.screen=this.flow.transitions[this.screen].c_next,this.render()):(h.value="",h.placeholder="Invalid PAN, try again?"):(h.value="",h.placeholder="PAN is required");break;case"select-polla":this.state.polla=b.getAttribute("data-polla"),Plugin.app.submitPollResponse(this.pollName,this.state.polla,this.showPollResults.bind(this))}},setFees:function(){this.state.ptype&&this.state.amount&&("monthly"===this.state.ptype||"yearly"===this.state.ptype||"quarterly"===this.state.ptype?this.state.feeStruct={base_amount:this.state.amount,fees:0,amount_to_pay:this.state.amount,button_amount:this.state.amount}:this.state.feeStruct=Plugin.app.payments.addFees(this.state.amount))},isValidPan:function(a){if(!a)return!1;if(a=a.toUpperCase().replace(/ /g,""),10!==a.length)return!1;var b=a.substring(0,3),c=a.substring(3,4),d=a.substring(4,5),e=a.substring(5,9),f=a.substring(9,10),g=b&&b.match(/[A-Z]+/);if(!g)return!1;var g=c&&c.match(/[CPHFATBLJG]/);if(!g)return!1;var g=d&&d.match(/[A-Z]/);if(!g)return!1;var g=e&&e.match(/[0-9]+/);if(!g)return!1;var g=f&&f.match(/[A-Z]/);return g?!0:!1},initPayment:function(a){switch(this.state.method){case"paytm":this.payWithPayTMSpot(a);break;case"other":this.payWithRazorpay_Spot(a);break;case"upi":case"cnb":case"cnbupi":this.payWithRazorpay_Spot(a);break;case"cards-auto-selected":this.payWithRazorpay_Subscription(a)}},payWithPayTMSpot:function(a){var b=this;Plugin.app.payments.payWithPayTMSpot({button_amount:this.state.feeStruct.button_amount,amount_to_pay:this.state.feeStruct.amount_to_pay,payment_type:"instant",callbacks:{success:function(a){Plugin.log(a),b.afterPayment(a)},paytmfail:function(a){Plugin.log(a),b.cancelPayment()},otherfail:function(){Plugin.log("otherfail"),b.cancelPayment()}}})},payWithRazorpay_Spot:function(a){Plugin.app.payments.payWithRazorpay_Spot({payment_type:"instant",button_amount:this.state.feeStruct.button_amount,amount_to_pay:this.state.feeStruct.amount_to_pay,callbacks:{ondismiss:this.cancelPayment.bind(this),onsuccess:this.afterPayment.bind(this)},usermethod:this.method})},payWithRazorpay_Subscription:function(a){Plugin.app.payments.payWithRazorpay_SubMerchantAccountSubscription({plan_amount:this.state.feeStruct.button_amount,subscription_type:this.state.ptype,callbacks:{ondismiss:this.cancelPayment.bind(this),onsuccess:this.afterPayment.bind(this),onerror:this.cancelPayment.bind(this)}})},cancelPayment:function(){this.screen=this.flow.transitions[this.screen].c_back,this.state.retrying=!0,this.render()},afterPayment:function(a,b){this.screen=b||this.flow.endscreen||this.flow.transitions[this.screen].c_next,this.state.txnid=a,this.state.ownerName=Plugin.app.configMgr.getConfigVal("ownerName");var c=Plugin.app.configMgr.getConfigVal("uxv2.externalthankyou");c&&(this.state.thankYouExt=c);var d=Plugin.app.configMgr.getConfigVal("uxv2.ytplaylists");if(d){var e=this.RAND_INT(d.length);this.state.playListImgUrl=d[e].playListImgUrl,this.state.playListTitle=d[e].playListTitle,this.state.playListUrl=d[e].playListUrl}this.render()},showPollResults:function(){console.log("showPollResults");var a=this;Plugin.app.getPollResults(this.pollName,function(b){a.state.poll_result=b;var c=0,d=0;for(var e in b){var f=Number(b[e]);c+=f,f>d&&(d=f)}if(0===c)a.state.poll_no_results=!0;else{a.state.poll_result_pctg={},a.state.poll_result_bar_width={};for(var e in b)f=Number(b[e]),a.state.poll_result_pctg[e]=Math.round(100*f/c),a.state.poll_result_bar_width[e]=Math.round(100*f/d)}a.screen="p_polla",a.render()})}})}(),Plugin.Views=Plugin.Views||{},function(){"use strict";Plugin.Views.LookupSubscription=Backbone.NativeView.extend({initialize:function(){this.ux={},this.subscription={},this.pubInfo={}},startup:function(){this.lookupSubscription()},lookupSubscription:function(){var a=this,b=new AWS.Lambda({region:"ap-south-1"}),c={pubname:Plugin.app.parsedParams.ownerid,action:"lookup"};this.subid&&(c.subId=this.subid),b.invoke({FunctionName:"LookupSubscription",Payload:JSON.stringify(c)},function(b,c){if(b)console.log(b);else{var d=JSON.parse(c.Payload);if(a.ux.bgColor=d.bgColor,a.ux.logo=d.logo,a.ux.name=d.name,!a.subid)return void a.renderLookup();d.error?(a.error=d.error,a.render()):(console.log(d),a.subscription.status=d.status,a.subscription.period=d.period,a.subscription.amount_inr=d.amount_inr,a.subscription.created_at=d.created_at,a.pubInfo.name=d.name,a.pubInfo.email=d.publisher_email,a.ux.stage="found-subscription","cancelled"===a.subscription.status?(a.subscription.ended_at=d.ended_at,a.subscription.paid_count=d.paid_count):"active"===a.subscription.status?(a.subscription.subscriber_email=d.subscriber_email,a.subscription.next_charge_date=d.next_charge_date,a.subscription.total_spend_till_date=d.total_spend_till_date):"pending"===a.subscription.status&&(a.subscription.subscriber_email=d.subscriber_email,a.subscription.next_charge_date=d.next_charge_date,a.subscription.total_spend_till_date=d.total_spend_till_date),a.render())}})},events:{"click #button_subid":"getSubId","click .stop-subscription":"stopSubscription"},close:function(){this.stopListening(),this.unbind(),this.undelegateEvents()},renderLookup:function(){this.el.innerHTML=JST["app/scripts/templates/Subscriptions/GetSubId.ejs"].apply({ux:this.ux,pubInfo:this.pubInfo})},getSubId:function(a){var b=document.getElementById("input_subid");if(b&&b.value){var c=b.value.trim();console.log(c),c.length>4&&"sub_"===c.substr(0,4)&&(this.subid=c,this.lookupSubscription())}},render:function(){this.el.innerHTML=JST["app/scripts/templates/Subscriptions/LookupSubscription.ejs"].apply({ux:this.ux,subid:this.subid,pubInfo:this.pubInfo,subscription:this.subscription,error:this.error||null})},stopSubscription:function(a){console.log("[LookupSubscription] stopSubscription"),this.ux.stage="please-wait",this.render();var b=this,c=new AWS.Lambda({region:"ap-south-1"});c.invoke({FunctionName:"LookupSubscription",Payload:JSON.stringify({pubname:Plugin.app.parsedParams.ownerid,subId:this.subid,action:"send-cancellation-email"})},function(a,c){a?(console.log(a),b.ux.stage="something-went-wrong"):b.ux.stage="cancellation-email-sent",b.render()})}})}(),Plugin.Views=Plugin.Views||{},function(){"use strict";Plugin.Views.CancelSubscription=Backbone.NativeView.extend({initialize:function(){this.ux={stage:"cancelling"},this.pubInfo={},this.render()},startup:function(){if(console.log(this.subid),console.log(this.token),!this.token)return this.ux.stage="invalid-cancellation-link",void this.render();var a=this,b=new AWS.Lambda({region:"ap-south-1"});b.invoke({FunctionName:"LookupSubscription",Payload:JSON.stringify({pubname:Plugin.app.parsedParams.ownerid,subId:this.subid,action:"cancel-subscription",token:this.token})},function(b,c){if(b)console.log(b),a.ux.stage="invalid-cancellation-link";else{a.ux.stage="subscription-cancelled";var d=JSON.parse(c.Payload);console.log(d),a.ux.bgColor=d.bgColor,a.ux.logo=d.logo,a.ux.name=d.name,a.pubInfo.email=d.publisher_email,d.error&&(a.ux.stage="invalid-cancellation-link")}a.render()})},events:{},close:function(){this.stopListening(),this.unbind(),this.undelegateEvents()},render:function(){this.el.innerHTML=JST["app/scripts/templates/Subscriptions/CancelSubscription.ejs"].apply({ux:this.ux,pubInfo:this.pubInfo,subid:this.subid})}})}();